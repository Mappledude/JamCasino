<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JamCasino â€” Admin</title>
  <link rel="stylesheet" href="./styles.css" />
  <style>
    body{display:flex;justify-content:center;align-items:center;height:100vh;background:var(--ink-3);color:var(--ink);}
    .card{background:var(--ink-2);padding:24px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4);display:flex;flex-direction:column;gap:12px;min-width:300px;}
    input,button{padding:8px 12px;border-radius:8px;border:1px solid #29336b;background:#0f1736;color:#e9edf3;font-size:14px;}
    button{cursor:pointer;background:var(--gold);color:var(--ink);font-weight:600;}
    #log{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;margin-top:10px;max-height:120px;overflow:auto;}
  </style>
</head>
<body>
  <div class="card">
    <h2>Create Table</h2>
    <input id="room-code" type="text" maxlength="8" placeholder="Room code (optional)" />
    <input id="min-buy" type="number" step="1" placeholder="Min Buy-in ($10)" />
    <input id="max-buy" type="number" step="1" placeholder="Max Buy-in ($20)" />
    <input id="sb" type="number" step="0.01" placeholder="Small Blind ($0.25)" />
    <input id="bb" type="number" step="0.01" placeholder="Big Blind ($0.50)" />
    <button id="create-table">Create Table</button>
    <div id="log"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDW9Subu-SEcSoe-uHNT8FzazZhgRknOHg",
      authDomain: "jamcasino-36b9a.firebaseapp.com",
      projectId: "jamcasino-36b9a",
      storageBucket: "jamcasino-36b9a.firebasestorage.app",
      messagingSenderId: "173219554638",
      appId: "1:173219554638:web:597524a6a30e71f3a2aa1f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    await signInAnonymously(auth);
    const db = getFirestore(app);

    const codeInput = document.getElementById('room-code');
    const minBuyInput = document.getElementById('min-buy');
    const maxBuyInput = document.getElementById('max-buy');
    const sbInput = document.getElementById('sb');
    const bbInput = document.getElementById('bb');
    const createBtn = document.getElementById('create-table');
    const logEl = document.getElementById('log');

    function log(event, payload={}){
      const entry = { ts: new Date().toISOString(), event, payload };
      const div = document.createElement('div');
      div.textContent = JSON.stringify(entry);
      logEl.appendChild(div);
      logEl.scrollTop = logEl.scrollHeight;
      console.log(entry);
    }

    function randomCode(){
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let s=''; for(let i=0;i<6;i++) s += chars[Math.floor(Math.random()*chars.length)];
      return s;
    }

    createBtn.onclick = async () => {
      const code = (codeInput.value || randomCode()).toUpperCase();
      const min = parseFloat(minBuyInput.value) || 10;
      const max = parseFloat(maxBuyInput.value) || 20;
      const sb = parseFloat(sbInput.value) || 0.25;
      const bb = parseFloat(bbInput.value) || 0.50;
      const roomRef = doc(db,'rooms',code);
      const existing = await getDoc(roomRef);
      if (existing.exists()) {
        log('admin.room.create.exists', { code });
        return;
      }
      await setDoc(roomRef, {
        code,
        state:'idle',
        seats:Array(9).fill(null),
        players:{},
        dealerSeat:null,
        nextVariant:null,
        config:{ minBuyIn:min, maxBuyIn:max, sb, bb },
        createdAt:serverTimestamp()
      });
      log('admin.room.create.success', { code, config:{min,max,sb,bb} });
      const msg = document.createElement('div');
      msg.textContent = `Created table ${code}`;
      const openBtn = document.createElement('button');
      openBtn.textContent = 'Open Table';
      openBtn.onclick = () => location.href = `/table.html?room=${encodeURIComponent(code)}`;
      msg.appendChild(document.createElement('br'));
      msg.appendChild(openBtn);
      logEl.appendChild(msg);
    };
  </script>
</body>
</html>
